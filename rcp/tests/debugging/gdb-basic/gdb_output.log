Function "__jit_debug_register_code" not defined.
Breakpoint 1 (__jit_debug_register_code) pending.
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
warning: could not find '.gnu_debugaltlink' file for /lib/x86_64-linux-gnu/libtinfo.so.6

R Under development (unstable) (2024-08-07 r86984) -- "Unsuffered Consequences"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Detaching after vfork from child process 2381593]
[Detaching after vfork from child process 2381595]
> library(rcp)
> 
> # Define inner function
> f_inner <- function(x) {
+   # Simple operation
+   return(x + 1)
+ }
> 
> # Define outer function that calls the compiled inner function
> f_outer <- function(x) {
+   # Call the JIT-compiled inner function
+   y <- f_inner_jit(x)
+   return(y * 2)
+ }
> 
> cat("Compiling inner function...\n")
Compiling inner function...
> f_inner_jit <- rcp::rcp_cmpfun(f_inner, list(name="inner_jit"))

Breakpoint 1, __jit_debug_register_code () at gdb_jit.c:64
64	void __attribute__((noinline)) __jit_debug_register_code(void) {
[GDB] Hit JIT registration (1/2). Finishing...
gdb_jit_register (func_name=func_name@entry=0x555555f9d598 "inner_jit", code_addr=code_addr@entry=0x555557d8c000 <inner_jit>, code_size=<optimized out>, inst_addrs=inst_addrs@entry=0x7ffff317d4a8, bytecode_count=bytecode_count@entry=7, bytecode=<optimized out>, stencil_variants=0x7ffff31b2648) at gdb_jit.c:796
796	  __jit_debug_descriptor.action_flag = JIT_NOACTION;
Breakpoint 2 at 0x555557d8c000: file /tmp/rcp_jit_RoAanv/inner_jit.S, line 1.
> 
> cat("Compiling outer function...\n")
Compiling outer function...
> f_outer_jit <- rcp::rcp_cmpfun(f_outer, list(name="outer_jit"))

Breakpoint 1, __jit_debug_register_code () at gdb_jit.c:64
64	void __attribute__((noinline)) __jit_debug_register_code(void) {
[GDB] Hit JIT registration (2/2). Finishing...
gdb_jit_register (func_name=func_name@entry=0x7ffff318d038 "outer_jit", code_addr=code_addr@entry=0x555557d8d000 <outer_jit>, code_size=<optimized out>, inst_addrs=inst_addrs@entry=0x7ffff30b3330, bytecode_count=bytecode_count@entry=16, bytecode=<optimized out>, stencil_variants=0x555556aab3f8) at gdb_jit.c:796
796	  __jit_debug_descriptor.action_flag = JIT_NOACTION;
Breakpoint 3 at 0x555557d8d000: file /tmp/rcp_jit_GztDPc/outer_jit.S, line 1.
> 
> cat("Executing outer function...\n")
Executing outer function...
> # This should trigger breakpoints in GDB
> res <- f_outer_jit(10)

Breakpoint 3, outer_jit () at /tmp/rcp_jit_GztDPc/outer_jit.S:1
1	__rcp_jit_prologue
[GDB] Hit outer_jit. Initial Backtrace:
#0  outer_jit () at /tmp/rcp_jit_GztDPc/outer_jit.S:1
#1  0x0000555555688aae in rcpEval (body=body@entry=0x7ffff30bcf40, rho=rho@entry=0x7ffff30bc568) at eval.c:7550
#2  0x00005555556a742b in Rf_eval (e=e@entry=0x7ffff30bcf40, rho=rho@entry=0x7ffff30bc568) at eval.c:1168
#3  0x00005555556a8ecf in R_execClosure (call=call@entry=0x7ffff30bc760, newrho=newrho@entry=0x7ffff30bc568, sysparent=<optimized out>, rho=rho@entry=0x555555a10998, arglist=arglist@entry=0x7ffff30bc5d8, op=op@entry=0x7ffff30bd090) at eval.c:2404
#4  0x00005555556a9dc7 in applyClosure_core (call=call@entry=0x7ffff30bc760, op=op@entry=0x7ffff30bd090, arglist=0x7ffff30bc5d8, rho=rho@entry=0x555555a10998, suppliedvars=<optimized out>, unpromise=unpromise@entry=TRUE) at eval.c:2318
[GDB] Stepping through outer_jit prologue...
0x0000555557d8d002	1	__rcp_jit_prologue
0x0000555557d8d004	1	__rcp_jit_prologue
0x0000555557d8d006	1	__rcp_jit_prologue
0x0000555557d8d008	1	__rcp_jit_prologue
0x0000555557d8d009	1	__rcp_jit_prologue
0x0000555557d8d00a	1	__rcp_jit_prologue
0x0000555557d8d00b	1	__rcp_jit_prologue
0x0000555557d8d00c	1	__rcp_jit_prologue
2	GETFUN_OP
[GDB] Reached bytecode in outer_jit. Instruction:
0x0000555557d8d021	2	GETFUN_OP
1: x/i $pc
=> 0x555557d8d021 <outer_jit+33>:	mov    %rsi,%rbp
#0  0x0000555557d8d021 in outer_jit () at /tmp/rcp_jit_GztDPc/outer_jit.S:2
0x0000555557d8d024	2	GETFUN_OP
1: x/i $pc
=> 0x555557d8d024 <outer_jit+36>:	mov    (%rsi),%rsi
#0  0x0000555557d8d024 in outer_jit () at /tmp/rcp_jit_GztDPc/outer_jit.S:2
[GDB] Continuing to inner_jit...

Breakpoint 2, inner_jit () at /tmp/rcp_jit_RoAanv/inner_jit.S:1
1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c000 <inner_jit>:	push   %r15
[GDB] Hit inner_jit. FULL BACKTRACE (Verify Stack):
#0  inner_jit () at /tmp/rcp_jit_RoAanv/inner_jit.S:1
#1  0x0000555555688aae in rcpEval (body=<optimized out>, rho=<optimized out>) at eval.c:7550
#2  0x0000555557d8b79b in ?? ()
#3  0x00007ffff3933f20 in ?? ()
#4  0x0000000000000000 in ?? ()
[GDB] Stepping through inner_jit prologue...
0x0000555557d8c002	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c002 <inner_jit+2>:	push   %r14
0x0000555557d8c004	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c004 <inner_jit+4>:	push   %r13
0x0000555557d8c006	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c006 <inner_jit+6>:	push   %r12
0x0000555557d8c008	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c008 <inner_jit+8>:	push   %rbp
0x0000555557d8c009	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c009 <inner_jit+9>:	push   %rbx
0x0000555557d8c00a	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c00a <inner_jit+10>:	push   %rax
0x0000555557d8c00b	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c00b <inner_jit+11>:	nop
0x0000555557d8c00c	1	__rcp_jit_prologue
1: x/i $pc
=> 0x555557d8c00c <inner_jit+12>:	call   0x555557d8c020 <inner_jit+32>
2	GETVAR_OP
1: x/i $pc
=> 0x555557d8c020 <inner_jit+32>:	sub    $0x18,%rsp
[GDB] Reached bytecode in inner_jit. Instruction:
0x0000555557d8c024	2	GETVAR_OP
1: x/i $pc
=> 0x555557d8c024 <inner_jit+36>:	lea    0x10(%rdi),%rax
#0  0x0000555557d8c024 in inner_jit () at /tmp/rcp_jit_RoAanv/inner_jit.S:2
> cat("Result:", res, "\n")
Result: 22 
> 
> 

Breakpoint 1, __jit_debug_register_code () at gdb_jit.c:64
64	void __attribute__((noinline)) __jit_debug_register_code(void) {
1: x/i $pc
=> 0x7ffff4589e70 <__jit_debug_register_code>:	endbr64
